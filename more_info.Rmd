---
title: "More information"
author: "Jessica Flohr, Lily Turner, and Sunshine Schneider"
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: kable
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Set R Markdown chunk defaults:
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, 
  fig.width = 16/2, fig.height = 9/2
)
```

<!--
Comments in HTML are like this! 
-->

```{r}
# Load necessary packages
library(tidyverse)
library(ggplot2)
library(leaflet)
library(sf)
library(leaflet.extras)

# Data import for chart
ag_productivity <- read.csv("ag_productivity.csv",
                            stringsAsFactors=FALSE)

# Data import for the leaflet map
farmers_markets <- read.csv("farmers_markets.csv",
                            stringsAsFactors=FALSE)

# Define "support" as how many food assistance programs a market accepts as payment
farmers_markets$support <- farmers_markets$WIC +
  farmers_markets$WICcash + farmers_markets$SFMNP +
  farmers_markets$SNAP
farmers_markets$support <- cut(farmers_markets$support, 
                               breaks=c(-Inf, .9, 1.9, 2.9, 3.9, Inf), 
                 labels=c("0","1","2","3","4"))

# Define "goods" as how many fresh diet essentials  market sells (vegetables, meat, fruits, and grains)
farmers_markets$goods <- farmers_markets$Vegetables +
  farmers_markets$Meat + farmers_markets$Fruits +
  farmers_markets$Grains
farmers_markets$goods <- cut(farmers_markets$goods, 
                               breaks=c(-Inf, .9, 1.9, 2.9, 3.9, Inf), 
                 labels=c("0","1","2","3","4"))

pal <- colorFactor(palette=c("red", "orange", "yellow",
                             "green", "blue"),
                   levels = c("0","1","2","3","4"))

```

# Farmers Markets and Food Assistance Programs

```{r}
leaflet(farmers_markets) %>% 
  addProviderTiles("Esri") %>% 
  addCircles(color = ~pal(support), group = "Support Programs") %>%
  addCircles(color = ~pal(goods), group = "Farm Goods") %>%
  addLayersControl(overlayGroups = c("Support", "Farm Goods"),
                   options = layersControlOptions(collapsed = FALSE)) %>%
  addLegend(position = "topright",
            pal = pal,
            values = c("0", "1", "2", "3", "4+")) %>%
  addResetMapButton()
```

# US Agricultural Productivity

```{r}
ggplot(ag_productivity, aes(x = Year)) +
  labs(title = "US Agricultural Productivity", 
       x = "Year", y = "Productivity increase per year") +
  geom_line(aes(y = Total_output, color = "Total output")) +
  geom_line(aes(y = Livestock_and_products_All, 
                color = "Livestock and products")) +
  geom_line(aes(y = Crops_All, color = "Agricultural crops"))

```
```{r}
# Graphs on percent of farmer's markets that accept various food aid
# Group by state, summarize state data into an average instead of per county

# import Excel file
farm_market <- read_excel("farm.market.xlsx")

# summarize support programs a farmers market accepts
sum_farm_support <- farm_market %>% 
  group_by(State) %>% 
  summarize(mean_SNAP = mean(PCT_FMRKT_SNAP16), 
            mean_WICCASH = mean(PCT_FMRKT_WICCASH16), 
            mean_SFNMP = mean(PCT_FMRKT_SFMNP16), 
            mean_WIC = mean(PCT_FMRKT_WIC16))
sum_farm_support[is.na(sum_farm_support)]<-0

# tidy farm support data to be able to make graphs
support_tidy <- gather(data = sum_farm_support, 
                       key = Type ,
                       value = Percent,
                       -State) 

# plotting graphs
ggplot(data = support_tidy,
       mapping = aes(x = Type, y = Percent, fill = Type)) +
  geom_col() +
  facet_wrap(~ State) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
```

